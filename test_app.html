<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Willnicht App</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
        #results { margin-top: 20px; }
        .result { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Willnicht App - Test Page</h1>

    <div class="section">
        <h2>1. Test Webhook Connection</h2>
        <button onclick="testWebhook()">Test Webhook (No Image)</button>
        <div id="webhookResult"></div>
    </div>

    <div class="section">
        <h2>2. Test File Upload</h2>
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="testImageUpload()">Upload & Test Webhook</button>
        <div id="uploadResult"></div>
    </div>

    <div class="section">
        <h2>3. Test App.js Integration</h2>
        <button onclick="loadAppScripts()">Load App Scripts</button>
        <div id="appScriptsResult"></div>
    </div>

    <script src="i18n.js"></script>
    <script>
        const WEBHOOK_URL = 'https://hook.eu1.make.com/9kor8vv2jkg97h95vs561rg10wxm99g3';

        function testWebhook() {
            const result = document.getElementById('webhookResult');
            result.innerHTML = '<p>Testing webhook...</p>';

            const formData = new FormData();
            formData.append('email', 'test@example.com');
            formData.append('user_language', 'Russian');
            formData.append('marketplace_language', 'German');
            formData.append('source_url', window.location.href);

            fetch(WEBHOOK_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                result.innerHTML += `<p>Status: ${response.status}</p>`;
                return response.text();
            })
            .then(text => {
                result.innerHTML += `<p>Response: ${text}</p>`;
            })
            .catch(error => {
                result.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            });
        }

        function testImageUpload() {
            const fileInput = document.getElementById('imageInput');
            const result = document.getElementById('uploadResult');

            if (!fileInput.files || fileInput.files.length === 0) {
                result.innerHTML = '<p style="color: red;">Please select an image first!</p>';
                return;
            }

            const file = fileInput.files[0];
            result.innerHTML = `<p>Uploading ${file.name} (${Math.round(file.size/1024)}KB)...</p>`;

            const formData = new FormData();
            formData.append('email', 'test@example.com');
            formData.append('user_language', 'Russian');
            formData.append('marketplace_language', 'German');
            formData.append('source_url', window.location.href);
            formData.append('image', file);

            fetch(WEBHOOK_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                result.innerHTML += `<p>Status: ${response.status}</p>`;
                return response.text();
            })
            .then(text => {
                result.innerHTML += `<pre>Response: ${text}</pre>`;
            })
            .catch(error => {
                result.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            });
        }

        function loadAppScripts() {
            const result = document.getElementById('appScriptsResult');
            result.innerHTML = '<p>Loading app.js...</p>';

            fetch('app.js')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to load');
                    return response.text();
                })
                .then(text => {
                    result.innerHTML = `<p>app.js loaded successfully! Size: ${text.length} characters</p>`;
                    result.innerHTML += `<p>First 500 chars:</p>`;
                    result.innerHTML += `<pre>${text.substring(0, 500)}</pre>`;
                })
                .catch(error => {
                    result.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                });
        }

        // Check i18n is loaded
        if (typeof t !== 'undefined') {
            console.log('i18n loaded successfully');
            console.log('Test translation:', t('btn_enter'));
        } else {
            console.warn('i18n not loaded');
        }
    </script>
</body>
</html>
